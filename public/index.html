<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Cyberminer</title>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/angular-route/angular-route.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css"/>
</head>
<body ng-app="cyberminer">
    <h1>Cyberminer Search Engine</h1>
    <a href="#/">Go to Search</a>
    <a href="#/manage">Go to Manage</a>
    <div ng-view></div>

    <script type="text/ng-template" id="/search.html">
        <div>
            <form ng-submit="search(query)">
                <select ng-model="query.operation" id="operation" required>
                    <option value="OR" selected>OR</option>
                    <option value="AND">AND</option>
                    <option value="NOT">NOT</option>
                </select>
                <input type="text" ng-model="keywords" id="keywords" required/>
                <button>Search</button>
            </form>
            <div>
                <div ng-repeat="index in results">
                    <h3><a ng-href="{{(index.url.startsWith('http')?'':'http://')+index.url}}">{{ index.url }}</a></h3>
                    <p>{{ index.description }}</p>
                </div>
            </div>
        </div>
    </script>
    <script type="text/ng-template" id="/manage.html">
        <div>
            <div>
                <h2>Add New Index</h2>

                <form ng-submit="addIndex(newIndex)">
                    <label for="url">URL:</label>
                    <input type="url" id="url" required ng-model="newIndex.url"/>
                    <label for="description">Description:</label>
                    <input type="text" id="description" required ng-model="newIndex.description"/>
                    <button>Add</button>
                </form>

            </div>
            <h2>Manage Existing Indices</h2>
            <div ng-repeat="index in indexes">
                <h3><a ng-href="{{(index.url.startsWith('http')?'':'http://')+index.url}}">{{ index.url }}</a></h3>
                <p>{{ index.description }}</p>
                <a href="" ng-click="deleteIndex(index.id)">Delete</a>
            </div>
        </div>
    </script>
    <script>
        var app = angular.module('cyberminer', ['ngRoute']);
        app.controller('MainCtrl', function($scope, $http) {
            $scope.query = {
                operation: "OR",
                keywords: []
            }
            $scope.search = function(query) {
                query.keywords = $scope.keywords.trim().split(/\s+/g);
                $http.post('/search', query).then(function(result) {
                    $scope.results = result.data;
                });
            }
            console.log($scope);
        });
        app.controller('ManageCtrl', function($scope, $http) {
            $http.get('/index').then(function(result) {
                $scope.indexes = result.data
            });
            $scope.newIndex = {};
            $scope.addIndex = function(index) {
                $http.post('/index', index).then(function(result) {
                    location.reload();
                });
            }
            $scope.deleteIndex = function(id) {
                $http.delete('/index/'+id).then(function(result) {
                    location.reload();
                });
            }
        });
        app.config(function($routeProvider) {
            $routeProvider.when('/', {
                controller: 'MainCtrl',
                templateUrl: '/search.html'
            })
            .when('/manage', {
                controller: 'ManageCtrl',
                templateUrl: '/manage.html'
            })
            .otherwise({redirectTo: '/'});
        });

    </script>
</body>
</html>
